"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const vscode_1=require("vscode"),functionsConfig=require("./data/functions.json"),keywordsConfig=require("./data/keywords.json"),Utilities_1=require("./Utilities"),functions=functionsConfig,keywords=keywordsConfig;class ShaderlabCompletionItemProvider{provideCompletionItems(t,e,o){t.lineAt(e).text.charAt(e.character-1);let i=[];return i=this.getNormalCaseSet(t),Promise.resolve(i)}getNormalCaseSet(t){let e=[];for(var o in functions.Items){i=functions.Items[o];e.push(this.getCompletionProposal(o,i.detail,i.documentation,functions.ItemKind))}for(var o in keywords.Items){var i=keywords.Items[o];for(var r in i){let t=i[r];t&&e.push(this.getCompletionProposal(t,"","",keywords.ItemKind))}}let n=t.getText();e=e.concat(this.getMethodInfo(n));let s=Utilities_1.default.getIncludeFilesContent(n,t.uri);s.forEach(t=>{e=e.concat(this.getMethodInfo(t))}),e=e.concat(this.getPropertiesInfo(n));var l=this.getStructuresInfo(n);e=e.concat(l),s.forEach(t=>{l=l.concat(this.getStructuresInfo(t)),e=e.concat(this.getStructuresInfo(t))});let a=[];return l.forEach(t=>{t&&a.push(t.label)}),e=e.concat(this.getVariablesInfo(n,a.join("|")))}getVariablesInfo(t,e){let o=[],i=Utilities_1.default.getVariablesFromCode(t,e);for(var r in i){let t=i[r];if(t){let e=t.substring(0,t.length-1).split(" ",2);if(2==e.length){let t=e[0].trim(),i=e[1].trim();o.push(this.getCompletionProposal(i,t,"",vscode_1.CompletionItemKind.Variable))}}}return o}getPropertiesInfo(t){return this.getCompletionItemFromMatchResult(t,Utilities_1.default.getPropertiesDefinationFromCode,t=>{let e=t.replace(/\(/gi,",").replace(/\)/gi,",").split(",");if(e.length>=4)return this.getCompletionProposal(e[0].trim(),e[2].trim(),"",vscode_1.CompletionItemKind.Property)})}getStructuresInfo(t){return this.getCompletionItemFromMatchResult(t,Utilities_1.default.getStructDefinationFromCode,t=>{let e=t.substring(6,t.length-7).split("{");if(e.length>=2)return this.getCompletionProposal(e[0].trim(),"struct","",vscode_1.CompletionItemKind.Struct)})}getMethodInfo(t){return this.getCompletionItemFromMatchResult(t,Utilities_1.default.getMethodCodeLineFromCode,t=>{let e=Utilities_1.default.getMethodNameFromSignatureCode(t);if(e)return this.getCompletionProposal(e,"",t.substring(0,t.length-1).trim(),vscode_1.CompletionItemKind.Method)})}getCompletionItemFromMatchResult(t,e,o){let i=[],r=e(t);for(var n in r){let t=r[n];if(t){let e=o(t);e&&i.push(o(t))}}return i}getCompletionProposal(t,e,o,i){let r=new vscode_1.CompletionItem(t,i);return r.detail=e,r.documentation=o,r}}ShaderlabCompletionItemProvider.triggerCharacters=[],exports.default=ShaderlabCompletionItemProvider;